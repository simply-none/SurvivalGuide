## 对象扩展

### 字符串扩展

- 字符的 Unicode 表示
  - es6 中允许采用`'\uxxxx'`表示一个字符，但只限于`'\u0000-ffff'`，对于超过的字符，会理解成`'\uxxxx+x..'`的形式，比如`'\u20bb7'`会被理解成`'\u20bb+7'`的形式，就是两部分连接
  - 解决方法：将码点放入大括号内即可正确解读字符，比如`'\u{20bb7}'`
  - 对于一个不可打印字符，会显示一个空格
- 新增的遍历器接口
  - 作用：**for...of**可以遍历字符串（包括字符的 Unicode 表示），for 循环不能遍历出超过范围的码点，会解释成 2 个字符
- 不能在字符串中表示的字符：**只能使用码点/特殊转义**使用
  - 反斜杠`\u005C`
  - 回车`\u000D`
  - 行分隔符`\u2028`
  - 段分隔符`\u2029`
  - 换行`\u000A`
  - es2019 允许 JavaScript 字符串/模板字符串中直接输入 u+2028/2029，但在 re 中不允许输入此字符
- 对 JSON.stringify()的改造
  - utf-8 规定对于 u+d800-dfff 之间的字符，必须配对使用，并且不能颠倒
  - 问题：可能返回配对码点的单个码点
  - 解决：为了确保返回合法的 utf-8 字符，es2019 遇到上述不正确组合码点/不存在的配对码点，会返回转义字符串，比如`JSON.stringify('\udf06\ud834')`返回`""\\udf06\\ud834""`，注意字符串 json 解析会多一个引号。
- **模板字符串**
  - 模板字符串使用反斜杠`括起，可以当作普通字符串/多行字符串/在内部引入变量
  - 在模板字符串中表示多行字符串，所有的空格/缩进/换行将会保留原样输出，可用`trim()`方法消除首尾空白
  - 模板字符串嵌入变量，需要将变量名写在`${}`内部
    - 大括号内部可以放入任意的 JavaScript 表达式，可以进行运算
    - 内部可以调用函数
    - 若不是字符串，则会按规则转为字符串形式
    - 使用未声明的变量将报错
  - 模板字符串可以互相嵌套
- **模板编译**
- **标签模板**

  - 标签模板是一种特殊的函数调用，跟在函数名后面，作为一个函数的参数
  - 其中模板字符串作为参数时，会被解析成多个部分：函数的第一个参数是**模板字符串没有变量替换的部分**，该参数类型为一个**数组**，而模板中的**表达式部分（变量）**会成为第二，三，四...个参数。

    - 注意：函数的形参与实参个数可以不相等

    ```javascript
    let total = 30;
    let msg = passthru`The total is ${total} (${total * 1.05} with tax)`;

    function passthru(literals) {
      let result = "";
      let i = 0;
      // 利用arguments来还原模板
      // 因为不能解析的字符串必然是被变量表达式所分割的
      while (i < literals.length) {
          // i++的妙用
        result += literals[i++];
        if (i < arguments.length) {
          result += arguments[i];
        }
      }

      return result;
    }

    msg; // "The total is 30 (31.5 with tax)"
    ```
    - 重要应用：**过滤HTML字符串，防止用户输入恶意内容**
    - 应用：进行多语言转换（国际化处理）
    - 问题：使用模板字符串在JavaScript语言中嵌入其他语言，但是模板字符串会默认将字符串转义
    - 解决：es2018放宽了对**标签模板**字符串转义限制，如果遇到不合法的字符串转义，则返回undefined
